USE database demo_db;

create database demo_db;
create schema demo_schema;

CREATE TABLE TBL_CUSTOMER AS SELECT * FROM SNOWFLAKE_SAMPLE_DATA.TPCH_SF100.CUSTOMER;

-- Adding the search optimization service.
ALTER TABLE TBL_CUSTOMER ADD SEARCH OPTIMIZATION;

ALTER TABLE TBL_CUSTOMER DROP SEARCH OPTIMIZATION;

SHOW TABLES LIKE '%CUSTOMER%';


-- This is how we check on which of the columns the search optimization service is enabled.
DESCRIBE SEARCH OPTIMIZATION ON TBL_CUSTOMER;

-- The cost of the search optimization services:
select SYSTEM$ESTIMATE_SEARCH_OPTIMIZATION_COSTS('TBL_CUSTOMER');


//Performance benchmarking to be done //

--Creating the tables with & without SOS.
CREATE TABLE LINEITEM_WITHSOS AS SELECT * FROM SNOWFLAKE_SAMPLE_DATA.TPCH_SF100.LINEITEM; ---
CREATE TABLE LINEITEM_WITHOUTSOS CLONE LINEITEM_WITHSOS; ---

-- Enabling the search optimization service.
ALTER TABLE LINEITEM_WITHSOS ADD SEARCH OPTIMIZATION;

SHOW TABLE LIKE '%'
SHOW TABLES LIKE '%LINEITEM_WITHSOS%';

-- Describing the details of the tables.
DESCRIBE SEARCH OPTIMIZATION ON LINEITEM_WITHSOS;
DESCRIBE SEARCH OPTIMIZATION ON LINEITEM_WITHOUTSOS;


--Running the queries.
SELECT * FROM LINEITEM_WITHOUTSOS WHERE L_ORDERKEY='155481735';

SELECT * FROM LINEITEM_WITHSOS WHERE L_ORDERKEY='155481735';


ALTER SESSION SET USE_CACHED_RESULT = FALSE;
ALTER WAREHOUSE COMPUTE_WH SUSPEND;

